<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, orientation=landscape">
    <title>éº»å°†é«˜çº§é…ç½® - å…¨å±€è”åŠ¨ç®¡ç† V4 (å¤šå±æ€§æ§åˆ¶ç‰ˆ)</title>
    <style>
        :root {
            --primary: #2F54EB;
            --primary-light: #f0f5ff;
            --secondary: #fa8c16;
            --bg-body: #F0F2F5;
            --bg-white: #FFFFFF;
            --text-main: #262626;
            --text-sub: #8C8C8C;
            --border: #E8E8E8;
            --line-color: #D9D9D9;
            --sidebar-width: 280px;
            
            /* å±‚çº§é¢œè‰²ç³»ç»Ÿ */
            --level-group-bg: #f9f0ff; --level-group-text: #722ed1; --level-group-border: #d3adf7;
            --level-comp-bg: #e6f7ff;  --level-comp-text: #1890ff; --level-comp-border: #91caff;
            --level-item-bg: #e6fffb;  --level-item-text: #13c2c2; --level-item-border: #87e8de;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; outline: none; }
        
        body { margin: 0; background: #222; height: 100vh; display: flex; align-items: center; justify-content: center; font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif; overflow: hidden; }

        /* --- è®¾å¤‡æ¨¡æ‹Ÿå™¨ --- */
        .device-shell {
            width: 960px; height: 500px;
            background: var(--bg-body);
            border: 12px solid #111; border-radius: 24px;
            position: relative; display: flex; overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,0.7);
        }

        .app-container { display: flex; width: 100%; height: 100%; position: relative; }

        /* 1. å·¦ä¾§ä¾§è¾¹æ  */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--bg-white);
            border-right: 1px solid var(--border);
            display: flex; flex-direction: column;
            z-index: 10;
        }
        .sidebar-header { height: 50px; padding: 0 16px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); font-weight: 600; color: var(--text-main); font-size: 14px; flex-shrink: 0;}
        .search-box { padding: 10px; border-bottom: 1px solid #f5f5f5; flex-shrink: 0;}
        .search-input { width: 100%; padding: 8px 12px; border: 1px solid #eee; border-radius: 6px; font-size: 12px; background: #f9f9f9; }
        
        .comp-list { flex: 1; overflow-y: auto; padding-bottom: 20px; }
        
        /* åˆ†ç»„æ ‡é¢˜æ ·å¼ */
        .group-header {
            padding: 12px 16px 4px 16px;
            font-size: 12px; font-weight: bold; color: var(--text-sub);
            text-transform: uppercase; letter-spacing: 0.5px;
            display: flex; align-items: center; gap: 6px;
            background: #fff; position: sticky; top: 0; z-index: 5;
        }
        .group-header::before { content:''; display:block; width:4px; height:4px; background:#ccc; border-radius:50%; }

        /* å…ƒä»¶é¡¹æ ·å¼ */
        .comp-item {
            padding: 8px 16px 8px 28px;
            display: flex; align-items: center; justify-content: space-between;
            cursor: pointer; transition: 0.2s; font-size: 13px; color: var(--text-main);
            border-left: 3px solid transparent;
        }
        .comp-item:hover { background: #fafafa; }
        .comp-item.active { background: #E6F7FF; border-left-color: var(--primary); color: var(--primary); font-weight: 500; }
        .rule-count { background: #f0f0f0; color: #999; font-size: 10px; padding: 1px 6px; border-radius: 10px; min-width: 20px; text-align: center; }
        .comp-item.active .rule-count { background: var(--primary); color: white; }

        /* 2. å³ä¾§å†…å®¹åŒº */
        .main-content { flex: 1; display: flex; flex-direction: column; background: var(--bg-body); }
        .main-header { height: 50px; padding: 0 24px; display: flex; align-items: center; justify-content: space-between; background: var(--bg-white); border-bottom: 1px solid var(--border); z-index: 5; flex-shrink: 0;}
        .header-title { font-weight: 600; font-size: 15px; color: var(--text-main); }
        
        .rules-container { flex: 1; padding: 20px 24px; overflow-y: auto; }
        .section-title { font-size: 12px; color: var(--text-sub); margin: 20px 0 12px 0; display: flex; align-items: center; gap: 8px; font-weight: 600; }
        
        /* è§„åˆ™å¡ç‰‡ */
        .summary-card { background: var(--bg-white); border-radius: 8px; padding: 16px; box-shadow: 0 2px 6px rgba(0,0,0,0.03); border: 1px solid transparent; cursor: pointer; transition: all 0.2s; margin-bottom: 12px; }
        .summary-card:hover { border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(47,84,235,0.1); }
        .summary-card.is-trigger { border-left: 3px solid var(--primary); }
        .summary-card.is-target { border-left: 3px solid var(--secondary); }
        
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .badge { font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: 500; }
        .badge.trigger { background: var(--primary-light); color: var(--primary); }
        .badge.target { background: var(--secondary-light); color: var(--secondary); }
        .shared-badge { display: inline-flex; align-items: center; gap: 4px; font-size: 10px; color: #d46b08; background: #fff7e6; padding: 1px 6px; border-radius: 4px; margin-left: 8px; border: 1px solid #ffd591; }
        
        .rule-desc { font-size: 13px; color: #333; line-height: 1.5; font-weight: 500; }
        
        /* åŠ¨ä½œåˆ—è¡¨ - å¤šå±æ€§å±•ç¤º */
        .action-list { margin-top: 12px; padding-top: 8px; border-top: 1px dashed #eee; display: flex; flex-wrap: wrap; gap: 8px; }
        
        .target-chip { display: inline-flex; align-items: center; border-radius: 4px; padding: 3px 8px; font-size: 11px; border: 1px solid transparent; }
        
        /* ğŸ“¦ ç»„çº§åˆ« */
        .target-chip.level-group { background: var(--level-group-bg); color: var(--level-group-text); border-color: var(--level-group-border); }
        .target-chip.level-group::before { content: 'ğŸ“¦'; margin-right: 4px; font-size: 10px; }
        
        /* ğŸ§© å…ƒä»¶çº§åˆ« */
        .target-chip.level-comp { background: var(--level-comp-bg); color: var(--level-comp-text); border-color: var(--level-comp-border); }
        .target-chip.level-comp::before { content: 'ğŸ§©'; margin-right: 4px; font-size: 10px; }
        
        /* ğŸ”¹ é€‰é¡¹çº§åˆ« */
        .target-chip.level-item { background: var(--level-item-bg); color: var(--level-item-text); border-color: var(--level-item-border); }
        .target-chip.level-item::before { content: 'ğŸ”¹'; margin-right: 4px; font-size: 10px; }
        
        .action-verb { font-weight: 700; margin-right: 4px; }
        .path-text { opacity: 0.6; margin-right: 2px; font-size: 10px;}
        .empty-state { padding: 30px; text-align: center; color: #ccc; font-size: 12px; background: rgba(255,255,255,0.5); border-radius: 8px; border: 1px dashed #ddd; }

        /* å¤šå±æ€§æ ‡ç­¾ */
        .multi-props { display: flex; gap: 2px; margin-left: 4px; }
        .prop-tag { font-size: 9px; padding: 1px 3px; border-radius: 2px; font-weight: 500; }
        .prop-tag.visible { background: #e6f7ff; color: #1890ff; }
        .prop-tag.disabled { background: #fff7e6; color: #fa8c16; }
        .prop-tag.selected { background: #f6ffed; color: #52c41a; }

        /* V5ç§»æ¤ï¼šé«˜äº®æ ·å¼ */
        .target-chip.highlight { 
            border-color: var(--primary) !important; 
            background: #fff !important; 
            box-shadow: 0 0 0 1px var(--primary) inset; /* å†…é˜´å½±æ¨¡æ‹Ÿè¾¹æ¡†åŠ ç²— */
        }

        /* V5ç§»æ¤ï¼šæŠ˜å æ ‡ç­¾æ ·å¼ */
        .target-chip.tag-others {
            background: #f5f5f5;
            color: #999;
            border: 1px dashed #ccc;
            cursor: help;
        }

        /* --- ç¼–è¾‘å™¨å±‚ --- */
        .editor-layer { position: absolute; top: 0; right: 0; bottom: 0; left: 0; background: var(--bg-body); z-index: 100; transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.2, 0, 0, 1); display: flex; flex-direction: column; }
        .editor-layer.open { transform: translateX(0); }
        .editor-header { height: 50px; background: white; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 16px; flex-shrink: 0; }
        .editor-body { flex: 1; display: flex; padding: 0; overflow: hidden; }
        .panel-conditions { flex: 5; border-right: 1px solid var(--border); display: flex; flex-direction: column; background: #FAFAFA; }
        .panel-actions { flex: 5; display: flex; flex-direction: column; background: white; }
        .panel-title { height: 40px; display: flex; align-items: center; justify-content: space-between; padding: 0 16px; font-size: 13px; font-weight: 600; color: var(--text-main); border-bottom: 1px solid #eee; background: white; flex-shrink: 0; }
        .scroll-area { flex: 1; overflow-y: auto; padding: 16px; }

        /* ç¼–è¾‘å™¨å†…éƒ¨æ§ä»¶ */
        .action-edit-card { 
            background: #fff; border: 1px solid var(--border); border-radius: 8px; 
            padding: 12px; margin-bottom: 12px; border-left: 3px solid var(--primary); 
            position: relative;
        }
        .action-edit-header { 
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 12px; font-size: 13px; font-weight: 600; 
        }
        .target-selector { 
            width: 100%; font-weight: 500; margin-bottom: 12px; 
        }
        
        /* ç›®æ ‡é€‰æ‹©å™¨ - ä¸¤æ­¥å¼ */
        .target-selector-wrapper {
            margin-bottom: 12px;
        }
        .selector-step {
            margin-bottom: 8px;
        }
        .step-label {
            font-size: 11px; color: #666; margin-bottom: 4px;
            display: flex; align-items: center; gap: 4px;
        }
        .step-number {
            width: 16px; height: 16px; border-radius: 50%;
            background: var(--primary); color: white;
            font-size: 10px; display: flex; align-items: center; justify-content: center;
        }
        .type-selector {
            display: flex; gap: 8px; margin-bottom: 8px;
        }
        .type-option {
            flex: 1; padding: 6px 8px; border: 1px solid #ddd; border-radius: 4px;
            text-align: center; cursor: pointer; font-size: 11px;
            background: white; transition: all 0.2s;
        }
        .type-option:hover {
            border-color: var(--primary);
        }
        .type-option.active {
            background: var(--primary-light); border-color: var(--primary);
            color: var(--primary); font-weight: 500;
        }
        .object-selector {
            opacity: 0.4; transition: opacity 0.2s;
        }
        .object-selector.enabled {
            opacity: 1;
        }

        /* å¤šå±æ€§é…ç½®åŒºåŸŸ */
        .props-config { 
            border: 1px dashed #e0e0e0; border-radius: 6px; 
            padding: 8px; background: #fafafa; 
        }
        .prop-row { 
            display: flex; align-items: center; justify-content: space-between; 
            margin-bottom: 8px; padding: 4px 0; 
            border-bottom: 1px solid #f0f0f0; 
        }
        .prop-row:last-child { margin-bottom: 0; border-bottom: none; }
        .prop-label { 
            display: flex; align-items: center; gap: 6px; 
            font-size: 12px; color: #666; min-width: 80px; 
        }
        .prop-checkbox { 
            width: 14px; height: 14px; margin: 0; 
        }
        .prop-controls { 
            display: flex; align-items: center; gap: 8px; flex: 1; 
        }
        .condition-label { 
            font-size: 10px; padding: 2px 6px; border-radius: 3px; 
            min-width: 50px; text-align: center; 
        }
        .condition-label.when { background: #e6f7ff; color: #1890ff; }
        .condition-label.else { background: #f5f5f5; color: #999; }
        
        .edit-select, .edit-input { border: 1px solid #eee; background: #F5F6FA; border-radius: 4px; padding: 4px 8px; font-size: 12px; height: 28px; color: var(--text-main); }
        
        /* æ ‘çŠ¶é€»è¾‘ */
        .tree-node { position: relative; padding-left: 24px; margin-bottom: 8px; }
        .tree-line { position: absolute; left: 0; top: 12px; bottom: 12px; width: 2px; background: var(--line-color); }
        .logic-btn { position: absolute; left: -12px; top: 50%; transform: translateY(-50%); width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; color: white; cursor: pointer; z-index: 10; box-shadow: 0 2px 4px rgba(0,0,0,0.15); transition: 0.2s; }
        .logic-btn.and { background-color: var(--primary); }
        .logic-btn.or { background-color: var(--secondary); }
        .rule-item { background: white; border: 1px solid #eee; padding: 6px; display: flex; gap: 6px; border-radius: 4px; font-size: 12px; align-items: center;}
        
        /* è­¦å‘Šå¼¹çª— */
        .warning-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 200; display: none; align-items: center; justify-content: center; backdrop-filter: blur(2px); }
        .warning-box { background: white; width: 320px; padding: 24px; border-radius: 16px; text-align: center; }
        
        .btn-primary { background: var(--primary); color: white; border: none; padding: 6px 16px; border-radius: 18px; font-size: 13px; cursor: pointer; }
        .btn-text { background: transparent; border: none; color: #666; cursor: pointer; }
        .btn-add-small { font-size: 11px; padding: 2px 8px; background: white; border: 1px dashed #ccc; border-radius: 10px; color: var(--text-sub); cursor: pointer; margin-left: 8px; }
        .btn-icon { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; color: #999; cursor: pointer; }
        .btn-icon:hover { color: #ff4d4f; }

    </style>
</head>
<body>

<div class="device-shell">
    
    <!-- LEVEL 1: DASHBOARD -->
    <div class="app-container" id="dashboard">
        <!-- å·¦ä¾§ï¼šæ˜¾ç¤ºç»„ > å…ƒä»¶ åˆ—è¡¨ -->
        <div class="sidebar">
            <div class="sidebar-header">
                <span>å…ƒä»¶æ¦‚è§ˆ</span>
                <span style="font-size:12px; color:var(--primary); cursor:pointer;">åˆ·æ–°</span>
            </div>
            <div class="search-box">
                <input type="text" class="search-input" placeholder="æœç´¢å…ƒä»¶...">
            </div>
            
            <div class="comp-list" id="compList">
                <!-- JS æ¸²æŸ“ -->
            </div>
        </div>

        <!-- å³ä¾§ï¼šè§„åˆ™è§†å›¾ -->
        <div class="main-content">
            <div class="main-header">
                <div class="header-title" id="headerTitle">å…¨éƒ¨è§„åˆ™</div>
                <button class="btn-primary" onclick="createNew()">+ æ–°å»ºè”åŠ¨</button>
            </div>
            
            <div class="rules-container" id="rulesContainer">
                <!-- JS æ¸²æŸ“ -->
            </div>
        </div>
    </div>

    <!-- LEVEL 2: äº¤äº’å¼ç¼–è¾‘å™¨ -->
    <div class="editor-layer" id="editorLayer">
        <div class="editor-header">
            <button class="btn-text" onclick="closeEditor()">â† è¿”å›</button>
            <span style="font-weight:600;" id="editorTitle">é…ç½®è”åŠ¨è¯¦æƒ…</span>
            <button class="btn-primary" onclick="saveAndClose()">ä¿å­˜è§„åˆ™</button>
        </div>
        <div class="editor-body">
            <!-- å·¦ï¼šæ¡ä»¶æ ‘ -->
            <div class="panel-conditions">
                <div class="panel-title">
                    <span>æ¡ä»¶åˆ¤æ–­ (IF)</span>
                    <span style="font-size:10px; color:#999; font-weight:400;">ç‚¹å‡»åœ†ç‚¹åˆ‡æ¢ ä¸”/æˆ–</span>
                </div>
                <div class="scroll-area" id="conditionTreeRoot">
                    <!-- JS æ¸²æŸ“æ¡ä»¶æ ‘ -->
                </div>
            </div>
            <!-- å³ï¼šåŠ¨ä½œåˆ—è¡¨ (å¤šå±æ€§é…ç½®) -->
            <div class="panel-actions">
                <div class="panel-title">
                    <span>æ‰§è¡ŒåŠ¨ä½œ (THEN)</span>
                    <div class="btn-add-small" onclick="addAction()" style="color:var(--primary); border-color:var(--primary);">+ æ–°å¢åŠ¨ä½œ</div>
                </div>
                <div class="scroll-area" id="actionListEdit">
                    <!-- JS æ¸²æŸ“åŠ¨ä½œ -->
                </div>
            </div>
        </div>
    </div>

    <!-- è­¦å‘Šå¼¹çª— -->
    <div class="warning-overlay" id="warningModal">
        <div class="warning-box">
            <div style="font-size: 32px; margin-bottom: 12px;">âš ï¸</div>
            <h3 style="margin: 0 0 8px 0; font-size: 16px;">å…±äº«è§„åˆ™æç¤º</h3>
            <p style="font-size: 13px; color: #666; line-height: 1.5; margin-bottom: 24px;">
                æ­¤è§„åˆ™åŒæ—¶æ§åˆ¶äº† <b id="sharedCount"></b> ä¸ªå¯¹è±¡ã€‚<br>ä¿®æ”¹å°†å½±å“å…¨å±€é…ç½®ã€‚
            </p>
            <div style="display:flex; gap:10px;">
                <button class="btn-text" style="flex:1; border:1px solid #eee; border-radius:18px;" onclick="closeWarning()">å–æ¶ˆ</button>
                <button class="btn-primary" style="flex:1;" onclick="confirmEdit()">ç»§ç»­ç¼–è¾‘</button>
            </div>
        </div>
    </div>

</div>

<script>
    // --- 1. æ•°æ®ç»“æ„ (Group > Component > Options) ---
    const formSchema = [
        {
            id: 'g_play', name: 'ç©æ³•è®¾ç½®',
            components: [
                { id: 'c_play1', name: 'å¬ç‰Œå¯æ‰˜ç®¡', type: 'bool', options: [{v:'true', l:'å¼€å¯'},{v:'false', l:'å…³é—­'}] },
                { id: 'c_play2', name: 'åƒå¼ ä¸æ‰“å¼ ', type: 'bool', options: [{v:'true', l:'å¼€å¯'},{v:'false', l:'å…³é—­'}] },
                { id: 'c_play3', name: 'å¯åƒå­—ç‰Œ', type: 'bool', options: [{v:'true', l:'å¼€å¯'},{v:'false', l:'å…³é—­'}] },
                { id: 'c_play4', name: 'å»å­—ç‰Œ', type: 'bool', options: [{v:'true', l:'å¼€å¯'},{v:'false', l:'å…³é—­'}] }
            ]
        },
        {
            id: 'g_buy', name: 'ä¹°ç è®¾ç½®',
            components: [
                { id: 'c_buy_mode', name: 'ä¹°ç æ–¹å¼', type: 'radio', options: [
                    {v: 'opt_none', l: 'ä¸ä¹°'},
                    {v: 'opt_1', l: 'ä¹°1ç '},
                    {v: 'opt_2', l: 'ä¹°2ç '}
                ]},
                { id: 'c_explode', name: 'çˆ†ç‚¸ç ', type: 'bool', options: [{v:'true', l:'å¼€å¯'},{v:'false', l:'å…³é—­'}] }
            ]
        },
        {
            id: 'g_score', name: 'åŠ åˆ†è®¾ç½®',
            components: [
                { id: 'c_huang', name: 'è’åº„åˆ†', type: 'number' },
                { id: 'c_gen', name: 'è·Ÿåº„åˆ†', type: 'number' }
            ]
        }
    ];

    // æ‰å¹³åŒ–å…ƒä»¶åˆ—è¡¨
    const flatComponents = formSchema.flatMap(g => g.components.map(c => ({...c, groupId: g.id})));

    // åˆå§‹è§„åˆ™æ•°æ® - V4: æ”¯æŒå¤šå±æ€§é…ç½® + V5ç§»æ¤ï¼šæ·»åŠ æ›´å¤šç›®æ ‡ç”¨äºæ¼”ç¤ºæŠ˜å 
    let rules = [
        {
            id: 101,
            triggers: ['c_play1'],
            desc: "å½“ [å¬ç‰Œå¯æ‰˜ç®¡] ç­‰äº 'å¼€å¯'",
            conditionTree: { id: 'root', logic: 'and', children: [{ type: 'rule', id: 'r1', field: 'c_play1', op: 'eq', val: 'true' }] },
            targets: [
                { 
                    id: 'g_score', level: 'group', name: 'åŠ åˆ†è®¾ç½®',
                    // V4: å¤šå±æ€§é…ç½®
                    props: {
                        visible: { enabled: true, when: 'hide', else: 'show' },
                        disabled: { enabled: false, when: 'lock', else: 'unlock' },
                        selected: { enabled: false, when: 'true', else: 'false' }
                    }
                },
                { 
                    id: 'c_play2', level: 'comp', name: 'åƒå¼ ä¸æ‰“å¼ ',
                    props: {
                        visible: { enabled: true, when: 'show', else: 'hide' },
                        disabled: { enabled: true, when: 'unlock', else: 'lock' },
                        selected: { enabled: false, when: 'true', else: 'false' }
                    }
                },
                // V5ç§»æ¤ï¼šæ·»åŠ ç¬¬ä¸‰ä¸ªç›®æ ‡ç”¨äºæ¼”ç¤ºæŠ˜å æ•ˆæœ
                { 
                    id: 'c_play3', level: 'comp', name: 'å¯åƒå­—ç‰Œ',
                    props: {
                        visible: { enabled: false, when: 'show', else: 'hide' },
                        disabled: { enabled: true, when: 'lock', else: 'unlock' },
                        selected: { enabled: false, when: 'true', else: 'false' }
                    }
                }
            ]
        },
        {
            id: 102,
            triggers: ['c_buy_mode'],
            desc: "å½“ [ä¹°ç æ–¹å¼] ç­‰äº 'ä¸ä¹°'",
            conditionTree: { id: 'root', logic: 'and', children: [{ type: 'rule', id: 'r2', field: 'c_buy_mode', op: 'eq', val: 'opt_none' }] },
            targets: [
                { 
                    id: 'c_explode', level: 'comp', name: 'çˆ†ç‚¸ç ',
                    props: {
                        visible: { enabled: false, when: 'show', else: 'hide' },
                        disabled: { enabled: true, when: 'lock', else: 'unlock' },
                        selected: { enabled: false, when: 'true', else: 'false' }
                    }
                }
            ]
        }
    ];

    // --- 2. çŠ¶æ€ç®¡ç† ---
    let activeFilter = 'all'; 
    let currentEditingRule = null;

    // --- 3. Dashboard æ¸²æŸ“é€»è¾‘ ---

    function renderSidebar() {
        const container = document.getElementById('compList');
        let html = `
            <div class="comp-item ${activeFilter==='all'?'active':''}" onclick="setFilter('all')">
                <span>å…¨éƒ¨è§„åˆ™æ¦‚è§ˆ</span>
                <span class="rule-count">${rules.length}</span>
            </div>
        `;

        formSchema.forEach(group => {
            html += `<div class="group-header">${group.name}</div>`;
            group.components.forEach(comp => {
                const count = rules.filter(r => r.triggers.includes(comp.id) || r.targets.some(t => t.id === comp.id || (t.level === 'group' && t.id === group.id))).length;
                html += `
                    <div class="comp-item ${activeFilter===comp.id?'active':''}" onclick="setFilter('${comp.id}')">
                        <span>${comp.name}</span>
                        ${count > 0 ? `<span class="rule-count">${count}</span>` : ''}
                    </div>
                `;
            });
        });
        container.innerHTML = html;
    }

    function renderRules() {
        const container = document.getElementById('rulesContainer');
        const titleEl = document.getElementById('headerTitle');
        
        if (activeFilter === 'all') {
            titleEl.innerText = 'å…¨éƒ¨è§„åˆ™æ¦‚è§ˆ';
            container.innerHTML = rules.map(r => renderCard(r, 'normal')).join('');
        } else {
            const currentComp = flatComponents.find(c => c.id === activeFilter);
            titleEl.innerText = `å…ƒä»¶ï¼š${currentComp.name}`;
            
            const activeRules = rules.filter(r => r.triggers.includes(activeFilter));
            const passiveRules = rules.filter(r => r.targets.some(t => t.id === activeFilter || (t.level === 'group' && t.id === currentComp.groupId)));

            let html = '';
            html += `<div class="section-title"><span style="color:var(--primary)">â—</span> ä¸»åŠ¨æ§åˆ¶ (Trigger)</div>`;
            html += activeRules.length ? activeRules.map(r => renderCard(r, 'trigger')).join('') : `<div class="empty-state">æœªæ§åˆ¶å…¶ä»–å¯¹è±¡</div>`;
            html += `<div class="section-title" style="margin-top:20px;"><span style="color:var(--secondary)">â—</span> è¢«åŠ¨å—æ§ (Target)</div>`;
            html += passiveRules.length ? passiveRules.map(r => renderCard(r, 'target')).join('') : `<div class="empty-state">ä¸å—å…¶ä»–æ¡ä»¶æ§åˆ¶</div>`;
            container.innerHTML = html;
        }
    }

    // V5ç§»æ¤ï¼šç”Ÿæˆ Target Chip çš„è¾…åŠ©å‡½æ•°
    function createTargetChipHtml(t, isHighlight) {
        let badgeClass = '', content = '';
        if (t.level === 'group') {
            badgeClass = 'level-group';
            content = `${t.name}`;
        } else if (t.level === 'comp') {
            badgeClass = 'level-comp';
            content = `${t.name}`;
        } else if (t.level === 'item') {
            badgeClass = 'level-item';
            content = `<span class="path-text">${t.parentName}/</span>${t.name}`;
        }

        // V4: æ˜¾ç¤ºå¤šå±æ€§æ ‡ç­¾
        let propTags = '';
        if (t.props) {
            if (t.props.visible && t.props.visible.enabled) propTags += `<span class="prop-tag visible">æ˜¾ç¤º</span>`;
            if (t.props.disabled && t.props.disabled.enabled) propTags += `<span class="prop-tag disabled">äº¤äº’</span>`;
            if (t.props.selected && t.props.selected.enabled) propTags += `<span class="prop-tag selected">é€‰ä¸­</span>`;
        }
        
        const highlightClass = isHighlight ? 'highlight' : '';
        return `<div class="target-chip ${badgeClass} ${highlightClass}">${content}<div class="multi-props">${propTags}</div></div>`;
    }

    function renderCard(r, type) {
        const isShared = r.targets.length > 1;
        const sharedBadge = isShared ? `<span class="shared-badge">ğŸ”— å…±äº«è§„åˆ™</span>` : '';
        let typeBadge = type === 'trigger' ? `<span class="badge trigger">å®ƒè§¦å‘</span>` : (type === 'target' ? `<span class="badge target">å®ƒå—æ§</span>` : '');

        let actionHtml = '';

        // V5ç§»æ¤ï¼šæ ¸å¿ƒæŠ˜å é€»è¾‘
        if (activeFilter !== 'all' && type === 'target') {
            const currentComp = flatComponents.find(c => c.id === activeFilter);
            
            // ç­›é€‰å‡ºä¸å½“å‰ç»„ä»¶ç›¸å…³çš„ç›®æ ‡ï¼ˆç›´æ¥IDåŒ¹é…ï¼Œæˆ–ç»„IDåŒ¹é…ï¼‰
            const relevantTargets = r.targets.filter(t => 
                t.id === activeFilter || 
                (t.level === 'group' && currentComp && t.id === currentComp.groupId)
            );
            
            const othersCount = r.targets.length - relevantTargets.length;

            if (relevantTargets.length > 0) {
                // ä»…æ¸²æŸ“ç›¸å…³ç›®æ ‡ï¼Œå¹¶é«˜äº®
                actionHtml += relevantTargets.map(t => createTargetChipHtml(t, true)).join('');
                
                // V5ç§»æ¤ï¼šæ¸²æŸ“æŠ˜å æ ‡ç­¾
                if (othersCount > 0) {
                    actionHtml += `<div class="target-chip tag-others">+ åŒæ—¶ä¹Ÿå½±å“å…¶ä»– ${othersCount} ä¸ªå¯¹è±¡</div>`;
                }
            } else {
                // ç†è®ºä¸Šä¸ä¼šè¿›å…¥è¿™é‡Œï¼Œå› ä¸º passiveRules å·²ç»è¿‡æ»¤è¿‡äº†
                actionHtml = r.targets.map(t => createTargetChipHtml(t, false)).join('');
            }

        } else {
            // æ™®é€šæ¨¡å¼ï¼šæ¸²æŸ“æ‰€æœ‰ç›®æ ‡ï¼Œæ— é«˜äº®
            actionHtml = r.targets.map(t => createTargetChipHtml(t, false)).join('');
        }

        return `
            <div class="summary-card is-${type}" onclick="handleCardClick(${r.id}, ${isShared})">
                <div class="card-header">
                    <span style="font-size:12px; color:#999;">Rule #${r.id}</span>
                    <div style="display:flex; align-items:center;">${typeBadge}${sharedBadge}</div>
                </div>
                <div class="rule-desc">${r.desc}</div>
                <div class="action-list">${actionHtml}</div>
            </div>
        `;
    }

    // --- 4. ç¼–è¾‘å™¨é€»è¾‘ ---

    // 4.1 æ¡ä»¶æ ‘æ¸²æŸ“ (Left Panel)
    function renderTree() {
        const container = document.getElementById('conditionTreeRoot');
        if (currentEditingRule && currentEditingRule.conditionTree) {
            container.innerHTML = renderGroup(currentEditingRule.conditionTree, true);
        }
    }

    function renderGroup(group, isRoot = false) {
        const logicText = group.logic === 'and' ? 'ä¸”' : 'æˆ–';
        const logicClass = group.logic === 'and' ? 'and' : 'or';
        return `
            <div class="tree-node" id="group-${group.id}">
                <div class="tree-line"></div>
                <div class="logic-btn ${logicClass}" onclick="toggleLogic('${group.id}')">${logicText}</div>
                <div>
                    ${group.children.map((child, index) => {
                        if (child.type === 'rule') return renderRuleItem(child, group.id, index);
                        if (child.type === 'group') return `<div class="sub-group">${renderGroup(child)}<div class="btn-icon" style="position:absolute;top:4px;right:4px;" onclick="removeNode('${group.id}', ${index})">âœ•</div></div>`;
                    }).join('')}
                </div>
                <div style="margin-top:8px; display:flex;">
                    <div class="btn-add-small" onclick="addCondition('${group.id}')">+ æ¡ä»¶</div>
                    ${isRoot ? `<div class="btn-add-small" style="margin-left:8px;" onclick="addGroup('${group.id}')">+ æ¡ä»¶ç»„</div>` : ''}
                </div>
            </div>
        `;
    }

    function renderRuleItem(rule, parentId, index) {
        const field = flatComponents.find(f => f.id === rule.field) || flatComponents[0];
        const hasOpts = field.options;
        return `
            <div class="rule-item">
                <select class="edit-select" style="width:100px;" onchange="updateRule('${parentId}', ${index}, 'field', this.value)">
                    ${flatComponents.map(f => `<option value="${f.id}" ${f.id === rule.field ? 'selected' : ''}>${f.name}</option>`).join('')}
                </select>
                <select class="edit-select" style="width:60px;" onchange="updateRule('${parentId}', ${index}, 'op', this.value)">
                    <option value="eq" ${rule.op==='eq'?'selected':''}>=</option>
                    <option value="neq" ${rule.op==='neq'?'selected':''}>â‰ </option>
                    <option value="gt" ${rule.op==='gt'?'selected':''}>&gt;</option>
                    <option value="include" ${rule.op==='include'?'selected':''}>åŒ…å«</option>
                </select>
                ${hasOpts ? 
                    `<select class="edit-select" style="flex:1" onchange="updateRule('${parentId}', ${index}, 'val', this.value)">
                         ${field.options.map(o => `<option value="${o.v}" ${o.v===rule.val?'selected':''}>${o.l}</option>`).join('')}
                     </select>` :
                    `<input type="text" class="edit-input" value="${rule.val || ''}" oninput="updateRule('${parentId}', ${index}, 'val', this.value)">`
                }
                <div class="btn-icon" onclick="removeNode('${parentId}', ${index})">âœ•</div>
            </div>
        `;
    }

    // 4.2 åŠ¨ä½œåˆ—è¡¨æ¸²æŸ“ (Right Panel) - V4: ä¸¤æ­¥å¼ç›®æ ‡é€‰æ‹©
    function renderEditorActions() {
        const container = document.getElementById('actionListEdit');
        if (!currentEditingRule.targets) return;

        container.innerHTML = currentEditingRule.targets.map((act, idx) => {
            return `
            <div class="action-edit-card">
                <div class="action-edit-header">
                    <span>ç›®æ ‡å¯¹è±¡</span>
                    <span style="color:#999; cursor:pointer;" onclick="removeAction(${idx})">âœ•</span>
                </div>
                
                <!-- V4: ä¸¤æ­¥å¼ç›®æ ‡é€‰æ‹©å™¨ -->
                <div class="target-selector-wrapper">
                    <!-- ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©ç›®æ ‡ç±»å‹ -->
                    <div class="selector-step">
                        <div class="step-label">
                            <span class="step-number">1</span>
                            <span>é€‰æ‹©ç›®æ ‡ç±»å‹</span>
                        </div>
                        <div class="type-selector">
                            <div class="type-option ${act.level==='group'?'active':''}" onclick="selectTargetType(${idx}, 'group')">
                                ğŸ“¦ æ˜¾ç¤ºç»„
                            </div>
                            <div class="type-option ${act.level==='comp'?'active':''}" onclick="selectTargetType(${idx}, 'comp')">
                                ğŸ§© å…ƒä»¶
                            </div>
                            <div class="type-option ${act.level==='item'?'active':''}" onclick="selectTargetType(${idx}, 'item')">
                                ğŸ”¹ é€‰é¡¹
                            </div>
                        </div>
                    </div>
                    
                    <!-- ç¬¬äºŒæ­¥ï¼šé€‰æ‹©å…·ä½“å¯¹è±¡ -->
                    <div class="selector-step">
                        <div class="step-label">
                            <span class="step-number">2</span>
                            <span>é€‰æ‹©å…·ä½“å¯¹è±¡</span>
                        </div>
                        <div class="object-selector ${act.level ? 'enabled' : ''}">
                            ${renderObjectSelector(act, idx)}
                        </div>
                    </div>
                </div>
                
                <!-- V4: å¤šå±æ€§é…ç½®åŒºåŸŸ -->
                <div class="props-config">
                    ${renderPropConfig(act, idx, 'visible', 'å¯è§æ€§', 'ğŸ‘ï¸')}
                    ${renderPropConfig(act, idx, 'disabled', 'äº¤äº’æ€§', 'ğŸ”’')}
                    ${renderPropConfig(act, idx, 'selected', 'é€‰ä¸­æ€§', 'âœ…')}
                </div>
            </div>
            `;
        }).join('');
    }

    // æ¸²æŸ“å…·ä½“å¯¹è±¡é€‰æ‹©å™¨ï¼ˆæ ¹æ®ç±»å‹åŠ¨æ€ç”Ÿæˆï¼‰
    function renderObjectSelector(action, actionIdx) {
        if (!action.level) {
            return `<select class="edit-select" style="width:100%;" disabled><option>è¯·å…ˆé€‰æ‹©ç›®æ ‡ç±»å‹</option></select>`;
        }

        let options = '';
        let selectedValue = '';

        if (action.level === 'group') {
            // æ˜¾ç¤ºç»„åˆ—è¡¨
            formSchema.forEach(g => {
                const isSelected = action.id === g.id;
                if (isSelected) selectedValue = g.id;
                options += `<option value="${g.id}" ${isSelected?'selected':''}>${g.name}</option>`;
            });
            return `<select class="edit-select" style="width:100%;" onchange="selectObject(${actionIdx}, this.value)">${options}</select>`;
            
        } else if (action.level === 'comp') {
            // å…ƒä»¶åˆ—è¡¨ï¼ˆæŒ‰ç»„åˆ†ç±»ï¼‰
            formSchema.forEach(g => {
                options += `<optgroup label="${g.name}">`;
                g.components.forEach(c => {
                    const isSelected = action.id === c.id;
                    if (isSelected) selectedValue = c.id;
                    options += `<option value="${c.id}" ${isSelected?'selected':''}>${c.name}</option>`;
                });
                options += `</optgroup>`;
            });
            return `<select class="edit-select" style="width:100%;" onchange="selectObject(${actionIdx}, this.value)">${options}</select>`;
            
        } else if (action.level === 'item') {
            // é€‰é¡¹çº§ï¼šéœ€è¦ä¸¤ä¸ªä¸‹æ‹‰æ¡†ï¼ˆå…ƒä»¶ + é€‰é¡¹ï¼‰
            let compOptions = '';
            let itemOptions = '';
            
            // å…ƒä»¶é€‰æ‹©å™¨
            formSchema.forEach(g => {
                g.components.forEach(c => {
                    if (c.options && c.options.length > 0) {
                        const isSelected = action.id === c.id;
                        compOptions += `<option value="${c.id}" ${isSelected?'selected':''}>${c.name}</option>`;
                    }
                });
            });
            
            // é€‰é¡¹é€‰æ‹©å™¨ï¼ˆåŸºäºå½“å‰é€‰ä¸­çš„å…ƒä»¶ï¼‰
            if (action.id) {
                const selectedComp = flatComponents.find(c => c.id === action.id);
                if (selectedComp && selectedComp.options) {
                    selectedComp.options.forEach(opt => {
                        const isSelected = action.targetVal === opt.v;
                        itemOptions += `<option value="${opt.v}" ${isSelected?'selected':''}>${opt.l}</option>`;
                    });
                }
            }
            
            return `
                <div style="display:flex; gap:8px;">
                    <select class="edit-select" style="flex:1;" onchange="selectItemComponent(${actionIdx}, this.value)">
                        <option value="">é€‰æ‹©å…ƒä»¶</option>
                        ${compOptions}
                    </select>
                    <select class="edit-select" style="flex:1;" onchange="selectItemOption(${actionIdx}, this.value)" ${!action.id?'disabled':''}>
                        <option value="">é€‰æ‹©é€‰é¡¹</option>
                        ${itemOptions}
                    </select>
                </div>
            `;
        }
        
        return '';
    }

    // V4: æ¸²æŸ“å•ä¸ªå±æ€§é…ç½®è¡Œ
    function renderPropConfig(action, actionIdx, propType, propLabel, icon) {
        const prop = action.props[propType];
        const isEnabled = prop.enabled;
        
        let whenOptions = '', elseOptions = '';
        if (propType === 'visible') {
            whenOptions = `<option value="show" ${prop.when==='show'?'selected':''}>æ˜¾ç¤º</option><option value="hide" ${prop.when==='hide'?'selected':''}>éšè—</option>`;
            elseOptions = `<option value="show" ${prop.else==='show'?'selected':''}>æ˜¾ç¤º</option><option value="hide" ${prop.else==='hide'?'selected':''}>éšè—</option>`;
        } else if (propType === 'disabled') {
            whenOptions = `<option value="lock" ${prop.when==='lock'?'selected':''}>é”å®š</option><option value="unlock" ${prop.when==='unlock'?'selected':''}>è§£é”</option>`;
            elseOptions = `<option value="lock" ${prop.else==='lock'?'selected':''}>é”å®š</option><option value="unlock" ${prop.else==='unlock'?'selected':''}>è§£é”</option>`;
        } else if (propType === 'selected') {
            whenOptions = `<option value="true" ${prop.when==='true'?'selected':''}>é€‰ä¸­</option><option value="false" ${prop.when==='false'?'selected':''}>ä¸é€‰ä¸­</option>`;
            elseOptions = `<option value="true" ${prop.else==='true'?'selected':''}>é€‰ä¸­</option><option value="false" ${prop.else==='false'?'selected':''}>ä¸é€‰ä¸­</option>`;
        }

        return `
            <div class="prop-row">
                <div class="prop-label">
                    <input type="checkbox" class="prop-checkbox" ${isEnabled?'checked':''} 
                           onchange="toggleProp(${actionIdx}, '${propType}', this.checked)">
                    <span>${icon} ${propLabel}</span>
                </div>
                <div class="prop-controls" style="opacity: ${isEnabled ? 1 : 0.4};">
                    <span class="condition-label when">æ»¡è¶³æ—¶</span>
                    <select class="edit-select" style="width:80px;" ${!isEnabled?'disabled':''} 
                            onchange="updatePropValue(${actionIdx}, '${propType}', 'when', this.value)">
                        ${whenOptions}
                    </select>
                    <span class="condition-label else">å¦åˆ™</span>
                    <select class="edit-select" style="width:80px;" ${!isEnabled?'disabled':''} 
                            onchange="updatePropValue(${actionIdx}, '${propType}', 'else', this.value)">
                        ${elseOptions}
                    </select>
                </div>
            </div>
        `;
    }

    // --- 5. æ•°æ®å¤„ç†å·¥å…·å‡½æ•° ---

    function findGroup(id, current = currentEditingRule.conditionTree) {
        if (current.id === id) return current;
        for (let child of current.children) {
            if (child.type === 'group') {
                const res = findGroup(id, child);
                if (res) return res;
            }
        }
        return null;
    }

    function toggleLogic(groupId) {
        const group = findGroup(groupId);
        if (group) {
            group.logic = group.logic === 'and' ? 'or' : 'and';
            renderTree();
        }
    }

    function addCondition(groupId) {
        const group = findGroup(groupId);
        if(group) {
            group.children.push({ type: 'rule', id: Date.now(), field: flatComponents[0].id, op: 'eq', val: '' });
            renderTree();
        }
    }
    
    function addGroup(groupId) {
        const group = findGroup(groupId);
        if(group) {
            group.children.push({ type: 'group', id: 'g'+Date.now(), logic: 'or', children: [{ type: 'rule', id: Date.now(), field: flatComponents[0].id, op: 'eq', val: '' }] });
            renderTree();
        }
    }

    function removeNode(parentId, index) {
        const group = findGroup(parentId);
        if(group) {
            group.children.splice(index, 1);
            renderTree();
        }
    }

    function updateRule(parentId, index, key, val) {
        const group = findGroup(parentId);
        if(group) {
            group.children[index][key] = val;
            if(key === 'field') renderTree();
        }
    }

    function addAction() {
        // V4: é»˜è®¤æ·»åŠ ä¸€ä¸ªæœªé…ç½®çš„åŠ¨ä½œ
        currentEditingRule.targets.push({ 
            // ä¸è®¾ç½®é»˜è®¤å€¼ï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©
            props: {
                visible: { enabled: true, when: 'show', else: 'hide' },
                disabled: { enabled: false, when: 'lock', else: 'unlock' },
                selected: { enabled: false, when: 'true', else: 'false' }
            }
        });
        renderEditorActions();
    }

    function removeAction(index) {
        currentEditingRule.targets.splice(index, 1);
        renderEditorActions();
    }

    // V4: ä¸¤æ­¥å¼ç›®æ ‡é€‰æ‹© - é€‰æ‹©ç›®æ ‡ç±»å‹
    function selectTargetType(actionIdx, type) {
        const action = currentEditingRule.targets[actionIdx];
        
        // é‡ç½®ç›®æ ‡å¯¹è±¡æ•°æ®
        action.level = type;
        delete action.id;
        delete action.name;
        delete action.parentName;
        delete action.targetVal;
        
        // æ ¹æ®ç±»å‹è®¾ç½®é»˜è®¤å€¼
        if (type === 'group' && formSchema.length > 0) {
            action.id = formSchema[0].id;
            action.name = formSchema[0].name;
        } else if (type === 'comp' && flatComponents.length > 0) {
            action.id = flatComponents[0].id;
            action.name = flatComponents[0].name;
        } else if (type === 'item') {
            // é€‰é¡¹çº§åˆ«éœ€è¦ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©ï¼Œä¸è®¾é»˜è®¤å€¼
        }
        
        renderEditorActions();
    }

    // V4: é€‰æ‹©å…·ä½“å¯¹è±¡ï¼ˆç»„æˆ–å…ƒä»¶ï¼‰
    function selectObject(actionIdx, objectId) {
        const action = currentEditingRule.targets[actionIdx];
        action.id = objectId;
        
        if (action.level === 'group') {
            const group = formSchema.find(g => g.id === objectId);
            action.name = group.name;
        } else if (action.level === 'comp') {
            const comp = flatComponents.find(c => c.id === objectId);
            action.name = comp.name;
        }
        
        renderEditorActions();
    }

    // V4: é€‰æ‹©é€‰é¡¹çº§åˆ«çš„å…ƒä»¶
    function selectItemComponent(actionIdx, compId) {
        const action = currentEditingRule.targets[actionIdx];
        action.id = compId;
        
        if (compId) {
            const comp = flatComponents.find(c => c.id === compId);
            action.parentName = comp.name;
            // é‡ç½®é€‰é¡¹å€¼
            delete action.targetVal;
            delete action.name;
        }
        
        renderEditorActions();
    }

    // V4: é€‰æ‹©é€‰é¡¹çº§åˆ«çš„å…·ä½“é€‰é¡¹
    function selectItemOption(actionIdx, optionValue) {
        const action = currentEditingRule.targets[actionIdx];
        action.targetVal = optionValue;
        
        if (optionValue && action.id) {
            const comp = flatComponents.find(c => c.id === action.id);
            const option = comp.options.find(opt => opt.v === optionValue);
            action.name = option.l;
        }
        
        renderEditorActions();
    }

    // V4: åˆ‡æ¢å±æ€§å¯ç”¨çŠ¶æ€
    function toggleProp(actionIdx, propType, enabled) {
        currentEditingRule.targets[actionIdx].props[propType].enabled = enabled;
        renderEditorActions();
    }

    // V4: æ›´æ–°å±æ€§å€¼
    function updatePropValue(actionIdx, propType, condition, value) {
        currentEditingRule.targets[actionIdx].props[propType][condition] = value;
    }

    // --- 6. å…¨å±€äº¤äº’ ---
    function setFilter(id) {
        activeFilter = id;
        renderSidebar();
        renderRules();
    }

    function handleCardClick(ruleId, isShared) {
        const rule = rules.find(r => r.id === ruleId);
        currentEditingRule = JSON.parse(JSON.stringify(rule)); // Deep Copy
        
        if (isShared) {
            document.getElementById('sharedCount').innerText = rule.targets.length;
            document.getElementById('warningModal').style.display = 'flex';
        } else {
            openEditor();
        }
    }

    function createNew() {
        currentEditingRule = {
            id: Date.now(),
            triggers: [],
            desc: 'æ–°è§„åˆ™ (æœªä¿å­˜)',
            conditionTree: { id: 'root', logic: 'and', children: [{ type: 'rule', id: Date.now(), field: flatComponents[0].id, op: 'eq', val: '' }] },
            targets: []
        };
        openEditor();
    }

    function openEditor() {
        document.getElementById('editorTitle').innerText = currentEditingRule.id > 1000 ? 'æ–°å»ºè§„åˆ™' : `ç¼–è¾‘è§„åˆ™ #${currentEditingRule.id}`;
        renderTree();
        renderEditorActions();
        document.getElementById('editorLayer').classList.add('open');
    }

    function closeEditor() { document.getElementById('editorLayer').classList.remove('open'); currentEditingRule = null; }
    function closeWarning() { document.getElementById('warningModal').style.display = 'none'; }
    function confirmEdit() { closeWarning(); openEditor(); }

    function saveAndClose() {
        // ç®€å•æ¨¡æ‹Ÿä¿å­˜
        currentEditingRule.desc = `è§„åˆ™å·²ä¿®æ”¹ (${new Date().toLocaleTimeString()})`;
        currentEditingRule.triggers = [flatComponents[0].id]; 

        const idx = rules.findIndex(r => r.id === currentEditingRule.id);
        if (idx >= 0) rules[idx] = currentEditingRule;
        else rules.push(currentEditingRule);
        
        renderRules();
        renderSidebar();
        closeEditor();
    }

    // --- Init ---
    renderSidebar();
    renderRules();

</script>
</body>
</html>