# 配置平台交互设计文档

## 1. 概述

本文档描述了微信小程序配置平台的交互设计和数据逻辑，旨在为开发人员提供清晰的实现指南。该配置平台基于Vue框架开发，主要用于游戏配置的可视化编辑，包括组件管理、属性配置、流程定义等功能。

## 2. 交互逻辑设计

### 2.1 整体布局

配置平台采用三栏式布局，包含以下主要区域：

- **左侧组件列表**：展示所有可用组件，按分类分组，支持搜索和展开/折叠操作
- **中间工作区**：包含工具栏、步骤条和可拖拽调整大小的面板
- **右侧属性面板**：显示选中组件的详细属性，支持属性编辑

### 2.2 核心交互流程

#### 2.2.1 组件管理流程

1. **组件浏览**：用户可通过左侧组件列表浏览所有可用组件，组件按分类分组展示
2. **组件搜索**：用户可在搜索框中输入关键词快速定位组件
3. **组件启用/禁用**：用户可通过开关控制组件的启用状态，强制开启的组件会被锁定
4. **组件分类**：启用的组件会自动添加到对应的分类步骤中

#### 2.2.2 工作区操作流程

1. **历史记录管理**：用户可通过工具栏的撤销/重做按钮或历史记录下拉菜单管理操作历史
2. **配置保存**：用户可通过保存按钮将当前配置保存到本地或服务器
3. **配置预览**：用户可通过预览按钮查看配置效果
4. **配置发布**：用户可通过发布按钮将配置发布到生产环境
5. **面板管理**：用户可在工作区中添加、拖拽、调整大小和删除面板

#### 2.2.3 属性编辑流程

1. **组件选择**：用户可点击分类中的组件或工作区中的面板选择组件
2. **属性展示**：右侧属性面板会自动显示选中组件的详细属性
3. **属性编辑**：用户可根据属性类型进行相应的编辑操作
4. **属性更新**：属性编辑完成后会自动更新到组件配置中

### 2.3 交互细节

#### 2.3.1 侧边栏折叠/展开

- 左侧组件列表和右侧属性面板均支持折叠/展开操作
- 折叠状态下仅显示图标，展开状态下显示完整内容
- 折叠/展开操作通过点击侧边栏顶部的切换按钮实现

#### 2.3.2 分类展开/折叠

- 左侧组件列表中的分类支持展开/折叠操作
- 点击分类标题可切换展开/折叠状态
- 展开状态下显示该分类下的所有组件

#### 2.3.3 面板拖拽调整

- 工作区中的面板支持拖拽移动和调整大小操作
- 拖拽时面板会跟随鼠标移动
- 调整大小时面板边缘会显示调整手柄
- 面板移动和调整大小会自动吸附到网格

#### 2.3.4 快捷键支持

- 撤销：Ctrl+Z
- 重做：Ctrl+Y
- 保存：Ctrl+S
- 预览：Ctrl+P
- 发布：Ctrl+Enter

## 3. 数据逻辑设计

### 3.1 数据结构

#### 3.1.1 组件数据结构

```javascript
{
  id: String,           // 组件唯一标识
  name: String,         // 组件名称
  category: String,     // 组件分类
  required: Boolean,    // 是否强制开启
  enabled: Boolean,     // 是否启用
  locked: Boolean,      // 是否锁定
  icon: String,         // 组件图标
  properties: Array     // 组件属性列表
}
```

#### 3.1.2 属性数据结构

```javascript
{
  id: String,           // 属性唯一标识
  name: String,         // 属性名称
  type: String,         // 属性类型（switch、toggle、select、checkbox、button、input等）
  defaultValue: Any,    // 默认值
  required: Boolean,    // 是否必填
  datas: Array          // 选项数据（用于select、toggle、checkbox等类型）
}
```

#### 3.1.3 面板数据结构

```javascript
{
  id: Number,           // 面板唯一标识
  x: Number,            // 面板X坐标
  y: Number,            // 面板Y坐标
  width: Number,        // 面板宽度
  height: Number,       // 面板高度
  title: String,        // 面板标题
  type: String,         // 组件类型
  category: String      // 组件分类
}
```

#### 3.1.4 分类数据结构

```javascript
{
  name: String,         // 分类名称
  components: Array     // 分类下的组件列表
}
```

#### 3.1.5 历史记录数据结构

```javascript
{
  action: String,       // 操作描述
  timestamp: String,    // 操作时间
  state: String         // 操作前的状态（JSON字符串）
}
```

### 3.2 数据加载与处理

#### 3.2.1 组件数据加载

组件数据通过异步请求加载，加载过程如下：

1. 从`/components_list.json`获取原始组件数据
2. 为每个组件添加默认图标、启用状态和锁定状态
3. 处理强制开启的组件，确保其状态为启用和锁定

#### 3.2.2 分类数据处理

分类数据从组件数据中提取，处理过程如下：

1. 从组件中提取唯一分类名称
2. 按照游戏流程顺序排序分类（基础、发牌前、发牌后、行牌、胡牌、算分）
3. 将强制开启的组件添加到对应的分类中

#### 3.2.3 数据过滤与分组

- **组件搜索**：根据搜索关键词过滤组件列表
- **组件分组**：按分类对过滤后的组件进行分组

### 3.3 状态管理

#### 3.3.1 核心状态

- `components`：组件列表数据
- `categories`：分类列表数据
- `panels`：面板列表数据
- `selectedComponent`：选中的组件
- `selectedComponentProperties`：选中组件的属性
- `searchKeyword`：搜索关键词
- `expandedCategories`：展开的分类
- `history`：操作历史记录
- `historyIndex`：当前历史记录索引

#### 3.3.2 状态更新

- **组件状态更新**：当用户启用/禁用组件时，更新组件的`enabled`状态，并将组件添加到/从分类中移除
- **面板状态更新**：当用户移动或调整面板大小时，更新面板的位置和大小信息
- **属性状态更新**：当用户编辑组件属性时，更新组件的属性值
- **历史记录更新**：当用户执行可撤销操作时，添加历史记录

### 3.4 历史记录管理

历史记录管理用于支持撤销/重做操作，实现过程如下：

1. 当用户执行可撤销操作时，记录操作前的状态到历史记录
2. 当用户点击撤销按钮时，回滚到上一条历史记录
3. 当用户点击重做按钮时，前进到下一条历史记录
4. 当用户点击历史记录下拉菜单中的条目时，回滚到指定的历史记录

### 3.5 配置保存与发布

#### 3.5.1 配置保存

配置保存功能将当前配置保存到本地存储或服务器，实现过程如下：

1. 收集当前所有组件的配置信息
2. 将配置信息转换为JSON格式
3. 保存到本地存储或发送到服务器
4. 添加保存操作到历史记录

#### 3.5.2 配置发布

配置发布功能将当前配置发布到生产环境，实现过程如下：

1. 验证配置的有效性
2. 将配置发送到生产环境服务器
3. 记录发布操作到历史记录

## 4. 功能模块设计

### 4.1 组件管理模块

**功能**：管理所有可用组件的展示、搜索、启用/禁用操作

**实现**：
- 使用`loadComponents`函数加载组件数据
- 使用`filteredComponents`计算属性过滤组件
- 使用`groupedComponents`计算属性分组组件
- 使用`toggleComponent`函数处理组件启用/禁用操作

**关联需求**：组件浏览、组件搜索、组件启用/禁用

### 4.2 分类管理模块

**功能**：管理组件分类的展示和组件分类关系

**实现**：
- 使用`loadCategories`函数加载分类数据
- 使用`addRequiredComponentsToCategories`函数添加强制开启的组件到分类
- 组件启用时自动添加到对应的分类

**关联需求**：组件分类、分类展示

### 4.3 工作区管理模块

**功能**：管理工作区中的面板操作

**实现**：
- 使用`addNewPanel`函数添加新面板
- 使用`updatePanel`函数更新面板位置和大小
- 使用`removePanel`函数删除面板
- 使用`selectPanel`函数选择面板

**关联需求**：面板管理、拖拽调整

### 4.4 属性编辑模块

**功能**：管理组件属性的展示和编辑

**实现**：
- 使用`selectedComponent`计算属性获取选中的组件
- 使用`selectedComponentProperties`计算属性获取选中组件的属性
- 根据属性类型渲染不同的编辑控件

**关联需求**：属性展示、属性编辑

### 4.5 历史记录模块

**功能**：管理操作历史记录，支持撤销/重做操作

**实现**：
- 使用`addHistory`函数添加历史记录
- 使用`undo`函数实现撤销操作
- 使用`redo`函数实现重做操作
- 使用`rollbackToHistory`函数回滚到指定历史记录

**关联需求**：历史记录管理、撤销/重做

### 4.6 配置管理模块

**功能**：管理配置的保存、预览和发布操作

**实现**：
- 使用`save`函数保存配置
- 使用`preview`函数预览配置
- 使用`publish`函数发布配置

**关联需求**：配置保存、配置预览、配置发布

## 5. 技术实现要点

### 5.1 响应式设计

- 使用Vue的`ref`和`computed`实现响应式状态管理
- 使用CSS的`transition`属性实现平滑的动画效果
- 使用Vue的`v-show`和`v-if`指令实现条件渲染

### 5.2 拖拽功能实现

- 使用`vue-draggable-resizable`组件实现面板的拖拽和调整大小功能
- 监听`dragging`和`resizing`事件更新面板状态

### 5.3 数据持久化

- 配置数据可保存到本地存储或服务器
- 使用JSON格式序列化和反序列化数据

### 5.4 性能优化

- 使用计算属性缓存派生状态，避免重复计算
- 使用`v-for`的`key`属性优化列表渲染性能
- 使用事件委托减少事件监听器数量

## 6. 未来扩展建议

1. **模板库功能**：添加预设模板，方便用户快速创建配置
2. **变量管理功能**：支持全局变量和组件变量的管理
3. **导入/导出功能**：支持配置的导入和导出，方便配置迁移
4. **版本管理功能**：支持配置的版本控制，方便回滚和对比
5. **协作编辑功能**：支持多人同时编辑配置，实时同步变更

## 7. 总结

本交互设计文档详细描述了微信小程序配置平台的交互逻辑和数据逻辑，为开发人员提供了清晰的实现指南。该配置平台采用模块化设计，具有良好的可扩展性和可维护性，能够满足游戏配置的各种需求。通过可视化的编辑界面，用户可以更高效地创建和管理游戏配置，提高工作效率。