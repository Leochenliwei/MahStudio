# 产品需求文档：游戏规则可视化配置后台 (V1.0)

## 1. 项目背景与目标
*   **背景**：当前游戏规则配置往往依赖代码硬编码或复杂的JSON文件，策划人员调整规则（如人数、局数、底分、玩法细节）效率低下。
*   **目标**：构建一个可视化的配置后台，允许策划人员通过拖拽组件、勾选选项、填写表单的方式，灵活配置各类棋牌/桌游的房间规则。支持基础参数设置及高级玩法逻辑的深度定制。

## 2. 功能范围 (Functional Scope)

### 🔴 核心功能 (V1.0)
1.  **基础规则配置**：支持人数、局数、底分等通用参数的预设与自定义。
2.  **组件化配置编辑器**：
    *   支持分组管理（添加、重命名、删除、排序）。
    *   支持动态添加UI控件（单选、复选、下拉列表、下拉并联）。
3.  **控件属性配置**：定义控件的标题、选项值、默认值、必填项校验及关联规则。
4.  **高级逻辑配置**：针对特定游戏阶段（发牌前、发牌后、摸打阶段、算分阶段）的详细逻辑参数设置（如庄家规则、连庄规则）。
5.  **选项联动设置**：定义选项之间的互斥或依赖关系。

### ⚪️ 不包含功能
*   前端游戏客户端的渲染逻辑（仅输出配置数据）。
*   多语言配置（V1.0仅支持中文）。
*   版本回滚与历史记录（V2.0规划）。

---

## 3. 交互逻辑设计

### 3.1 规则编辑主流程
1.  **进入编辑页**：显示当前规则列表。
2.  **添加/编辑分组**：用户点击左侧“添加分组”，主视窗生成新的配置区块。
3.  **添加组件**：在分组内点击“单选/复选/下拉”按钮，生成对应控件占位符。
4.  **配置组件属性**：点击控件右侧的“设置（齿轮）”图标 $\rightarrow$ 弹出侧边/模态框 $\rightarrow$ 输入选项名称、值、规则 $\rightarrow$ 点击保存 $\rightarrow$ 控件更新显示。
5.  **全局保存**：配置完成后点击页面底部/顶部的保存按钮，生成配置文件。

### 3.2 高级设置跳转
*   **触发**：点击特定复杂逻辑项（如“详细规则”或“玩法选项”）的配置按钮。
*   **响应**：跳转至全屏的“详细规则编辑器”（即图右侧页面），支持侧边栏导航切换不同阶段的配置。

---

## 4. 页面详细说明

### 4.1 规则配置主页面 (Main Configuration Canvas)
对应图中左侧及中间部分，是操作的核心区域。

*   **页面布局**：
    *   **左侧工具栏**：
        *   `[+添加分组]` 按钮：点击后在内容区底部追加一个新的空白分组。
        *   `[选项联动]` 按钮：点击打开联动逻辑配置弹窗（定义选项A选中时，选项B隐藏等逻辑）。
    *   **中部内容区**：垂直排列的规则配置列表。
*   **交互元素说明**：
    1.  **通用参数行（如人数、局数）**：
        *   **展示**：Label（标题） + Radio Group（选项组） + Checkbox（特殊标记如“少人开局”）。
        *   **操作**：点击右侧 ⚙️ 图标，弹出**参数预设弹窗**（见4.2）。
    2.  **自定义分组（Group）**：
        *   **组头操作**：
            *   显示组名（支持点击重命名）。
            *   右侧操作菜单：包含 [重命名]、[删除]、[上移]、[分列]（调整布局列数）。
        *   **组件添加栏**：位于组内底部，提供 `[+单选]`、`[+复选]`、`[+下拉列表]`、`[+下拉&并联]` 快捷按钮。
    3.  **拖拽与排序**：支持长按分组或组内控件进行上下拖拽排序。

### 4.2 参数预设弹窗 (Parameter Settings Modal)
对应图中左下角的两个弹窗示例（设置人数选项、设置局数选项）。

*   **功能**：用于定义在前端显示给玩家看的具体选项内容。
*   **人数选择弹窗**：
    *   **选项组合**：提供常用的组合模板，如“4人/3人/2人，默认4人”。
    *   **单选项定义**：支持勾选具体的选项值，设置默认值。
*   **局数选择弹窗**：
    *   **模式切换**：Tab切换 `[打局]` vs `[打圈]`。
    *   **选项组合**：提供如“4/8/16局”或“8/16/32局”的预设配置。
*   **底部操作**：`[保存]` 按钮，点击后更新主页面的显示。

### 4.3 元件属性配置层 (Component Property Configurator)
对应图中中间偏右的悬浮面板/弹窗。

*   **触发条件**：在主页面点击任意自定义控件（如新添加的“单选1”）的编辑状态或设置按钮。
*   **输入项**：
    1.  **分组名称/标题**：输入框，定义该控件在客户端显示的标题（如“玩法选择”）。
    2.  **选项列表管理**：
        *   **列表项**：每一行包含 `选项名`（前端显示文本）、`赋值`（后端逻辑值）、`规则标签`（如蓝色tag "规则1"）。
        *   **属性勾选**：`不可填`（禁用）、`默认选中`。
        *   **操作**：支持添加选项、删除选项、拖拽排序。
    3.  **添加选项按钮**：点击在列表底部新增一行。
*   **保存**：点击 `[保存]`，校验必填项后关闭弹窗并刷新主页面控件状态。

### 4.4 高级规则/详细逻辑配置页 (Advanced Rules Page)
对应图中主要流程的最右侧页面，用于深度配置游戏内核逻辑。

*   **页面结构**：
    *   **顶部**：面包屑导航（返回上一级）、当前编辑项标题（如“xxxx选项的规则”）。
    *   **右侧导航栏**：垂直Tab导航，按游戏阶段划分：
        *   `基础规则`、`发牌前阶段`、`发牌后阶段`、`摸打阶段`、`天胡`、`胡牌阶段`、`算分阶段`。
    *   **中部内容区**：根据右侧导航选中的模块显示对应表单。
*   **内容区交互（以“坐庄”为例）**：
    *   **启用开关**：Switch开关，控制该模块逻辑是否生效。
    *   **逻辑字段**：
        *   **首局坐庄**：Radio Button（房主坐庄 / 随机坐庄）。
        *   **庄家接炮**：Dropdown Select（如“庄家连庄”）。
        *   **闲家接炮**：Dropdown Select。
        *   **若一炮多响**：Dropdown Select（如“点炮玩家坐庄”）。
        *   **荒庄/流局**：Dropdown Select（如“庄家连庄”）。
*   **底部操作**：`[保存并离开]` 按钮，保存所有Tab页下的修改并返回主配置页。

---

## 5. 数据逻辑与规则

1.  **数据结构**：所有配置最终需序列化为标准JSON格式，包含 `group_id`, `component_type`, `options: [{label, value, is_default}]`, `dependencies` 等字段。
2.  **必填校验**：
    *   控件标题不能为空。
    *   单选/复选控件至少包含一个选项。
    *   选项值（Value）在同一控件内不可重复。
3.  **联动逻辑**（基于“选项联动”按钮）：
    *   支持定义 `IF [控件A] = [值1] THEN [控件B] = [显示/隐藏/禁用]` 的简单逻辑。
