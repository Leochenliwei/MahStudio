# 创房面板功能技术方案设计

## 1. 技术方案概述

### 1.1 项目背景
- 基于现有的Vue 3 + Vite项目，构建游戏规则可视化配置后台的创房面板功能
- 允许策划人员通过可视化界面配置游戏房间规则，替代传统的代码硬编码或复杂JSON配置

### 1.2 技术栈
- **前端框架**：Vue 3 (Composition API)
- **构建工具**：Vite
- **路由**：Vue Router
- **状态管理**：Vue 3 响应式API + localStorage持久化
- **UI组件**：自定义组件 + Lucide图标库

## 2. 核心功能设计

### 2.1 功能模块

#### 2.1.1 创房面板主界面
- **布局**：模态框形式，覆盖在工作台之上
- **结构**：
  - 顶部：标题栏（含返回按钮）
  - 左侧：基础规则配置区
  - 右侧：高级规则配置区
  - 底部：操作按钮（保存、取消）

#### 2.1.2 基础规则配置
- **人数配置**：单选按钮组，支持预设选项和自定义
- **局数配置**：单选按钮组，支持打局和打圈两种模式
- **底分配置**：输入框，支持数值输入
- **时间配置**：各阶段时间限制设置

#### 2.1.3 高级规则配置
- **分组管理**：支持添加、重命名、删除、排序分组
- **控件添加**：支持添加单选、复选、下拉列表、下拉并联等控件
- **控件属性配置**：支持配置控件标题、选项值、默认值、必填项校验等
- **选项联动设置**：支持定义选项之间的互斥或依赖关系

#### 2.1.4 高级规则/详细逻辑配置页
- **页面结构**：全屏页面，包含侧边导航和内容区
- **导航**：按游戏阶段划分的垂直Tab导航
- **内容区**：根据导航选中的模块显示对应表单

### 2.2 数据模型设计

#### 2.2.1 创房配置数据结构
```javascript
// roomConfig.js
export const defaultRoomConfig = {
  id: '',
  name: '',
  basic: {
    playerCount: {
      options: [4, 3, 2],
      default: 4,
      allowLess: false
    },
    roundCount: {
      mode: 'round', // 'round' | 'circle'
      options: [4, 8, 16],
      default: 4
    },
    baseScore: 1,
    timeLimits: {
      prepare: 30,
      discard: 20,
      think: 15
    }
  },
  groups: [
    {
      id: 'group_1',
      name: '基础玩法',
      components: [
        {
          id: 'comp_1',
          type: 'radio', // 'radio' | 'checkbox' | 'select' | 'select并联'
          title: '玩法选择',
          options: [
            { label: '标准玩法', value: 'standard', isDefault: true },
            { label: '经典玩法', value: 'classic', isDefault: false }
          ],
          required: false
        }
      ]
    }
  ],
  dependencies: [] // 选项联动规则
};
```

#### 2.2.2 组件属性配置数据结构
```javascript
// componentConfig.js
export const componentTypes = {
  RADIO: 'radio',
  CHECKBOX: 'checkbox',
  SELECT: 'select',
  SELECT_PARALLEL: 'select并联'
};

export const defaultComponentConfig = {
  id: '',
  type: componentTypes.RADIO,
  title: '',
  options: [],
  required: false,
  disabled: false
};
```

## 3. 技术实现方案

### 3.1 组件结构设计

#### 3.1.1 核心组件
- **RoomCreator.vue**：创房面板主组件，模态框形式
- **BasicConfig.vue**：基础规则配置组件
- **AdvancedConfig.vue**：高级规则配置组件
- **ComponentEditor.vue**：控件属性编辑组件
- **DependencyEditor.vue**：选项联动规则编辑组件
- **AdvancedRulesPage.vue**：高级规则/详细逻辑配置页面

#### 3.1.2 辅助组件
- **PlayerCountConfig.vue**：人数配置弹窗
- **RoundCountConfig.vue**：局数配置弹窗
- **GroupManager.vue**：分组管理组件
- **ComponentAdder.vue**：控件添加组件

### 3.2 路由设计
```javascript
// router/index.js
const routes = [
  {
    path: '/',
    name: 'Admin',
    component: Admin
  },
  {
    path: '/workbench/:id',
    name: 'Workbench',
    component: Workbench,
    props: true
  },
  {
    path: '/workbench/:id/advanced-rules',
    name: 'AdvancedRules',
    component: AdvancedRulesPage,
    props: true
  }
];
```

### 3.3 状态管理设计

#### 3.3.1 创房配置状态
```javascript
// 在RoomCreator.vue中使用
const roomConfig = ref({ ...defaultRoomConfig });
const isOpen = ref(false);
const activeTab = ref('basic'); // 'basic' | 'advanced'

// 保存配置
function saveConfig() {
  const config = { ...roomConfig.value };
  localStorage.setItem(`roomConfig_${gameId}`, JSON.stringify(config));
  // 通知工作台更新
  emit('config-updated', config);
  closePanel();
}

// 加载配置
function loadConfig() {
  const savedConfig = localStorage.getItem(`roomConfig_${gameId}`);
  if (savedConfig) {
    roomConfig.value = JSON.parse(savedConfig);
  }
}
```

### 3.4 集成方案

#### 3.4.1 与工作台集成
```javascript
// 在Workbench.vue中添加
function openRoomCreator() {
  // 打开创房面板
  store.commit('roomCreator/setIsOpen', true);
  // 传递当前游戏配置ID
  store.commit('roomCreator/setGameId', route.params.id);
}
```

#### 3.4.2 工具栏按钮绑定
```html
<!-- Workbench.vue中的底部工具栏 -->
<button class="toolbar-item" @click="openRoomCreator">
  <Icon name="box" size="18" />
  <span>创房选项</span>
</button>
```

## 4. 界面设计

### 4.1 创房面板UI
- **模态框**：居中显示，固定宽度（800px），可滚动
- **顶部**：标题栏，包含"创房配置"标题和关闭按钮
- **内容区**：
  - 左侧：基础规则配置，包含人数、局数、底分等设置
  - 右侧：高级规则配置，包含分组管理和控件配置
- **底部**：操作按钮区，包含"保存"和"取消"按钮

### 4.2 高级规则页面UI
- **顶部**：面包屑导航和页面标题
- **左侧**：垂直Tab导航，按游戏阶段划分
- **右侧**：内容区，根据选中的导航显示对应表单
- **底部**："保存并离开"按钮

## 5. 数据持久化

### 5.1 本地存储
- 使用localStorage存储创房配置，键名为`roomConfig_{gameId}`
- 支持配置的保存、加载和重置

### 5.2 配置导出/导入
- 支持将配置导出为JSON文件
- 支持从JSON文件导入配置

## 6. 性能优化

### 6.1 渲染优化
- 使用Vue 3的虚拟DOM和响应式系统
- 组件懒加载
- 计算属性缓存

### 6.2 交互优化
- 防抖处理：输入框和选择器的变化
- 节流处理：拖拽操作
- 动画过渡：模态框显示/隐藏、选项切换

## 7. 实现步骤

### 7.1 第一步：创建核心组件
1. 创建`RoomCreator.vue`主组件
2. 创建`BasicConfig.vue`和`AdvancedConfig.vue`子组件
3. 创建相关的辅助组件

### 7.2 第二步：实现数据模型
1. 定义创房配置数据结构
2. 实现状态管理逻辑
3. 实现数据持久化

### 7.3 第三步：实现UI界面
1. 实现创房面板的布局和样式
2. 实现各种配置选项的UI控件
3. 实现高级规则页面

### 7.4 第四步：集成与测试
1. 与工作台系统集成
2. 测试各种配置场景
3. 优化性能和用户体验

## 8. 技术风险与解决方案

### 8.1 技术风险
- **数据复杂度**：创房配置数据结构复杂，可能导致状态管理困难
- **UI复杂度**：需要实现多种类型的配置控件，UI开发工作量大
- **性能问题**：配置选项过多时可能导致渲染性能下降

### 8.2 解决方案
- **数据管理**：使用模块化的数据结构，合理划分配置项
- **组件化**：采用组件化开发，提高代码复用性
- **性能优化**：使用虚拟列表、懒加载等技术优化渲染性能
- **测试覆盖**：编写单元测试和集成测试，确保功能稳定性

## 9. 预期效果

- 实现一个功能完整、界面友好的创房面板配置系统
- 支持基础规则和高级规则的可视化配置
- 提高策划人员配置游戏规则的效率
- 与现有工作台系统无缝集成

## 10. 后续扩展

- 支持多语言配置
- 支持配置版本管理和回滚
- 支持配置模板库
- 支持实时预览配置效果