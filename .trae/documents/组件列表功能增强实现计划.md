# 组件列表功能增强实现计划

## 一、需求分析

1. **搜索功能**：在组件列表中添加搜索输入框，支持根据组件名称和描述进行实时搜索
2. **筛选功能**：添加分类筛选器，根据组件的 category 属性进行筛选
3. **强制开启组件**：识别并处理强制开启的组件，在初始化时自动开启并锁定

## 二、实现步骤

### 1. 修改 components_list.json
- 为需要强制开启的组件添加 `required: true` 属性
- 建议将以下基础组件设置为强制开启：
  - 牌库 (iezZIQ)
  - 游戏模式 (1Gy4Sh)
  - 发牌组件 (SSS1eN)
  - 胡牌规则 (10GRvO)

### 2. 修改 Workbench.vue

#### a. 添加搜索和筛选功能
- 在 `components-sidebar` 中添加搜索输入框
- 添加分类筛选下拉菜单
- 实现搜索和筛选的计算属性

#### b. 实现强制开启组件逻辑
- 修改 `loadComponents` 函数，检查组件的 `required` 属性
- 为强制开启的组件设置 `enabled: true` 和 `locked: true`
- 在组件切换逻辑中，禁止修改锁定组件的状态

#### c. 界面调整
- 为锁定的组件添加锁定图标
- 禁用锁定组件的开关
- 优化搜索和筛选控件的样式

### 3. 具体代码实现

#### a. 数据处理
```javascript
// 加载组件列表数据
async function loadComponents() {
  try {
    const response = await fetch('/components_list.json')
    const data = await response.json()
    // 为每个组件添加默认图标、启用状态和锁定状态
    components.value = data.components.map(component => ({
      ...component,
      icon: '📦', // 默认图标
      description: component.category, // 使用分类作为描述
      enabled: component.required || false, // 强制开启的组件默认启用
      locked: component.required || false // 强制开启的组件默认锁定
    }))
  } catch (error) {
    console.error('加载组件列表失败:', error)
  }
}
```

#### b. 搜索和筛选逻辑
```javascript
// 搜索关键词
const searchKeyword = ref('')
// 选中的分类
const selectedCategory = ref('all')

// 过滤后的组件列表
const filteredComponents = computed(() => {
  return components.value.filter(component => {
    // 搜索过滤
    const matchesSearch = !searchKeyword.value || 
      component.name.toLowerCase().includes(searchKeyword.value.toLowerCase()) ||
      component.description.toLowerCase().includes(searchKeyword.value.toLowerCase())
    
    // 分类过滤
    const matchesCategory = selectedCategory.value === 'all' || 
      component.category === selectedCategory.value
    
    return matchesSearch && matchesCategory
  })
})

// 获取所有分类
const allCategories = computed(() => {
  const categories = new Set(components.value.map(component => component.category))
  return ['all', ...categories]
})
```

#### c. 组件切换逻辑
```javascript
// 切换组件启用状态
function toggleComponent(component) {
  // 如果组件被锁定，不允许切换
  if (component.locked) {
    return
  }
  
  // 检查组件是否要启用
  if (component.enabled) {
    // 检查是否有相同ID的组件已经启用
    const isDuplicate = components.value.some(c => c.id !== component.id && c.enabled && c.id === component.id)
    if (isDuplicate) {
      alert('该组件已经启用，不能重复启用！')
      component.enabled = false
      return
    }
    
    // 找到对应的分类并添加组件
    const category = categories.value.find(cat => cat.name === component.category)
    if (category) {
      category.components.push(component)
      // 添加历史记录
      addHistory(`启用组件: ${component.name}`)
    }
  } else {
    // 找到对应的分类并移除组件
    const category = categories.value.find(cat => cat.name === component.category)
    if (category) {
      const index = category.components.findIndex(c => c.id === component.id)
      if (index !== -1) {
        category.components.splice(index, 1)
        // 添加历史记录
        addHistory(`取消启用组件: ${component.name}`)
      }
    }
  }
}
```

#### d. 界面修改
- 在组件列表顶部添加搜索输入框和分类筛选器
- 为组件项添加锁定图标和状态
- 禁用锁定组件的开关

## 三、技术要点

1. **响应式设计**：使用 Vue 3 的计算属性实现实时搜索和筛选
2. **状态管理**：合理管理组件的 enabled 和 locked 状态
3. **用户体验**：
   - 为锁定的组件添加视觉提示
   - 禁用锁定组件的交互
   - 优化搜索和筛选的性能
4. **代码复用**：尽量复用现有的组件和逻辑，减少代码冗余

## 四、预期效果

1. 用户可以通过搜索框快速找到需要的组件
2. 用户可以通过分类筛选器查看特定类别的组件
3. 强制开启的组件在初始化时自动开启并锁定，用户无法关闭
4. 界面清晰展示组件的状态和锁定信息

## 五、测试计划

1. 验证强制开启的组件是否自动开启并锁定
2. 验证搜索功能是否正常工作
3. 验证分类筛选功能是否正常工作
4. 验证锁定组件是否无法被关闭
5. 验证非锁定组件的开启/关闭功能是否正常

## 六、依赖分析

- 仅修改现有文件，不需要引入新的依赖
- 保持与现有代码风格和架构的一致性
- 确保修改不会影响其他功能的正常运行